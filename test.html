<!DOCTYPE html><html lang="zh-Hans">
<head>
<meta charset="UTF-8">
<meta http-equiv="expires" content="0"/>
<meta http-equiv="pragma" content="no-cache"/>
<meta http-equiv="cache-control" content="no-cache"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
<meta name="viewport" content="initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,minimal-ui">
<meta name="format-detection" content="telephone=no,email=no"/>
<title>确认身份</title>
<link rel="stylesheet" href="http//cdn.mobimedical.cn/source/libs/weui/weui.min.css">
<link rel="stylesheet" href="http//cdn.mobimedical.cn/source/common/css/normalize.css">
<link rel="stylesheet" href="http//cdn.mobimedical.cn/ysd/tpl/Wap/static/YSD/css/list.css?v=0.0.1">
<script src="http//cdn.mobimedical.cn/source/libs/weui/weui.min.js"></script>
<script src="http//cdn.mobimedical.cn/source/libs/jquery/jquery-3.1.1.min.js"></script>
<script src="http//cdn.mobimedical.cn/ysd/tpl/Wap/static/libs/vue/vue.min.js"></script>
<script src="http//cdn.mobimedical.cn/source/common/js/plugin.dialog.js"></script>
<link rel="stylesheet" href="http//cdn.mobimedical.cn/source/common/css/plugin.css">
</head>
<body>
 <div>
    <label for="jsonInput">Enter JSON Data:</label>
    <textarea id="jsonInput" rows="4" cols="50">{"code":200,"msg":"","data":{"jsApiParameters":"{\"appId\":\"wxfdd02a5bec574795\",\"nonceStr\":\"iizj3pahqmvip60kghru5qm7fblclb1j\",\"package\":\"prepay_id=wx290801215403930eaac37dd6cee1a40001\",\"signType\":\"MD5\",\"timeStamp\":\"1753747281\",\"paySign\":\"69A7455984E2103C755AA502E4F7E805\"}","regId":143701130}}</textarea>
    <br>
    <button onclick="onCreateOrder()">Create Order</button>
</div>
    
    
<script>  
    var isUpdate = "1";
    var verifySwitch = "1";
    var regType = "";
    var loading;
    var isClose=false;

 function onCreateOrder() {
    try {
        var jsonData = JSON.parse(document.getElementById("jsonInput").value);
        goCreateOrder(jsonData);
    } catch (e) {
        alert("Invalid JSON data entered. Please check the input.");
    }
}
  
    // 创建订单接口
        function goCreateOrder(json) {
        //开启倒计时
		
            
             
                if (json.code == 200) {
                    var payData = json.data;
                        //调用微信支付
                        callWeixinPay(payData.jsApiParameters, payData.regId);
                    
                } else if ((json.code == 300)) {
                    //存在未支付订单
                    confirmUnPay(json.data,json)
                } else if ((json.code == 400)) {
                    // 缓存刷新提交
                    sessionStorage.setItem('isOnloadSubmit','1');
                    weui.alert(json.msg,function (){
                        window.location.replace(document.referrer)
                    });
                } else if ((json.code == 401)) {
                    // 缓存刷新提交
                    sessionStorage.setItem('isOnloadSubmit','1');
                    weui.alert(json.msg,function (){
                        window.location.replace(document.referrer)
                    });

                }else if ((json.code == 911)) {
                    // 缓存刷新提交
                    isClose= false;
                    downTime();
                    sessionStorage.setItem('isOnloadSubmit','1');
                    setTimeout(function(){
                        isClose = true;
                        weui.alert('系统繁忙',function (){
                            window.location.replace(document.referrer)
                        });
                    },30000)
                }
        
        }

    // 未支付订单提醒
    function confirmUnPay(url,json) {
        weui.confirm(json.msg, {
            title: '温馨提示',
            buttons: [{
                label: '取消',
                type: 'default',
                onClick: function(){ }
            }, {
                label: '确定',
                type: 'primary',
                onClick: function(){
                    window.location.href = url;
                }
            }]
        });
    }

    var clicked = 0;

    //微信支付方法
    function jsApiCall(jsApiParameters, regId) {
        jsApiParameters = jQuery.parseJSON(jsApiParameters);
        WeixinJSBridge.invoke(
            'getBrandWCPayRequest',
            jsApiParameters,
            function (res) {
                if (res.err_msg == "get_brand_wcpay_request:ok") {
                    window.location.href = "http://his.mobimedical.cn/index.php?g=Wap&m=CloudRegister&a=processing&wx=MbTXAN0k&regId=" + regId;
                } else if (res.err_msg == "get_brand_wcpay_request:cancel") {
                    alert("支付已取消");
                    clicked = 0;
                } else {
                    alert(res.err_code + "2--" + res.err_desc + "--" + res.err_msg);
                }


            }
        );
    }

    //调用微信支付
    function callWeixinPay(jsApiParameters, regId) {
        if (clicked == 1)
            return;
        clicked = 1;
        if (typeof WeixinJSBridge == "undefined") {
            if (document.addEventListener) {
                document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
            } else if (document.attachEvent) {
                document.attachEvent('WeixinJSBridgeReady', jsApiCall);
                document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
            }
        } else {
            jsApiCall(jsApiParameters, regId);
        }
    }





</script></html></body></html>